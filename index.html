<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIDisclose Statement Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Professional Palette */
            --primary: #2563eb;       /* Royal Blue */
            --primary-hover: #1d4ed8;
            --surface: #ffffff;
            --background: #f1f5f9;    /* Slate 100 */
            --text-main: #0f172a;     /* Slate 900 */
            --text-secondary: #475569; /* Slate 600 */
            --border: #e2e8f0;        /* Slate 200 */
            --border-focus: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --radius: 8px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.5;
            margin: 0;
            padding: 40px 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        h1 {
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 10px;
            letter-spacing: -0.025em;
        }
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        .subtitle code {
            background: #e0e7ff;
            color: var(--primary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* --- Cards & Sections --- */
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        h2::before {
            content: '';
            display: block;
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
        }

        /* --- Forms --- */
        .form-grid {
            display: grid;
            gap: 20px;
        }
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 600px) { .row { grid-template-columns: 1fr; } }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-main);
            font-size: 0.95rem;
        }
        .help-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: block;
        }

        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            color: var(--text-main);
            font-family: inherit;
            transition: border-color 0.15s, box-shadow 0.15s;
            box-sizing: border-box;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* --- Custom Checkboxes --- */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            cursor: pointer;
        }
        .checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        .checkbox-wrapper span {
            font-size: 0.95rem;
            color: var(--text-main);
        }

        /* --- Taxonomy Grid Layout --- */
        .masonry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        .taxonomy-card {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 15px;
        }
        .taxonomy-card h3 {
            margin: 0 0 12px 0;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            font-weight: 700;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 8px;
        }
        .tax-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .tax-item:hover {
            color: var(--primary);
        }
        .tax-item input {
            margin-top: 4px;
            margin-right: 8px;
            accent-color: var(--primary);
        }

        /* --- Dynamic Comments --- */
        .comment-box {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-left: 3px solid var(--primary);
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .comment-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Buttons --- */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        .btn-primary {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-1px);
        }
        .btn-secondary {
            background-color: white;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover {
            background-color: #f8fafc;
            color: var(--text-main);
            border-color: #cbd5e1;
        }
        .btn-danger {
            background-color: #fee2e2;
            color: var(--danger);
            padding: 6px 12px;
            font-size: 0.8rem;
        }
        .btn-danger:hover { background-color: #fecaca; }

        /* --- Output Area --- */
        #output-area {
            display: none;
            margin-top: 40px;
            scroll-margin-top: 20px;
        }
        .code-container {
            background: #1e1e1e; /* Dark theme */
            border-radius: var(--radius);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        .code-header {
            background: #2d2d2d;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #ccc;
            font-size: 0.85rem;
            border-bottom: 1px solid #444;
        }
        pre {
            margin: 0;
            padding: 20px;
            color: #d4d4d4;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* --- Footer/Sponsors --- */
        .footer-sponsor {
            margin-top: 50px;
            text-align: center;
            border-top: 1px solid var(--border);
            padding-top: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .counter-badge {
            background: #e2e8f0;
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 15px;
            transition: background-color 0.3s, color 0.3s;
        }
    </style>
</head>
<body>

<div class="container">
    
    <header>
        <h1>Generative AI Disclosure Generator</h1>
        <p class="subtitle">
            Generate compliant LaTeX code for the <code>aidisclose</code> package (v1.11.0).
        </p>
    </header>

    <div class="card">
        <h2>General Information</h2>
        <div class="form-grid">
            <div>
                <label for="authors">Authors *</label>
                <input type="text" id="authors" placeholder="e.g. Jane Doe, John Smith" required>
                <span class="help-text">Full names of authors accepting responsibility.</span>
            </div>
            <div>
                <label for="tools">AI Tools Used</label>
                <input type="text" id="tools" placeholder="e.g. ChatGPT-4, GitHub Copilot, Grammarly">
                <span class="help-text">Comma separated list of tools.</span>
            </div>
            
            <div>
                <label>Comments & Details</label>
                <div id="comments-container"></div>
                <button type="button" class="btn-secondary" onclick="addCommentBox()" style="width:100%; text-align:center; border-style:dashed;">
                    + Add Specific Comment
                </button>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Configuration & Rendering</h2>
        <div class="row">
            <div>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="opt-autobib" checked>
                    <span>Auto-generate BibTeX file (<code>autobib</code>)</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="opt-nocite" checked>
                    <span>Suppress footnote citation (<code>nocite</code>)</span>
                </label>
                <label class="checkbox-wrapper">
                    <input type="checkbox" id="render-star">
                    <span>No Title (<code>\AIDrenderDeclaration*</code>)</span>
                </label>
    
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <div>
                        <label for="render-cols">Columns</label>
                        <input type="number" id="render-cols" value="3" min="1" max="6" style="width: 80px;">
                    </div>
                    <!-- <div style="flex: 1;"> -->
                    <div style="width: 180px;">
                        <label for="render-lang">Language</label>
                        <select id="render-lang">
                            <option value="default" selected>Default</option>
                            <option value="en">English (en)</option>
                            <option value="pt">Portuguese (pt)</option>
                            <option value="cat">Catalan (cat)</option>
                            <option value="cz">Czech (cz)</option>
                            <option value="da">Danish (da)</option>
                            <option value="nl">Dutch (nl)</option>
                            <option value="fr">French (fr)</option>
                            <option value="de">German (de)</option>
                            <option value="gr">Greek (gr)</option>
                            <option value="it">Italian (it)</option>
                            <option value="pl">Polish (pl)</option>
                            <option value="sk">Slovak (sk)</option>
                            <option value="es">Spanish (es)</option>
                            <option value="uk">Ukrainian (uk)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div>                
                <label for="title-full" style="margin-top:0px">Custom Section Title (Optional)</label>
                <input type="text" id="title-full" placeholder="Default: Generative AI Disclosure">
                
                <div class="row" style="margin-top:10px; gap:10px;">
                    <input type="text" id="title-short" placeholder="Short Title (TOC)">
                    <input type="text" id="title-level" placeholder="\section, \chapter...">
                </div>

                <label for="render-label" style="margin-top: 15px;">LaTeX Label</label>
                <input type="text" id="render-label" placeholder="e.g. sec:aid_declaration">
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Taxonomy of Delegated Tasks</h2>
        <p class="help-text" style="margin-bottom: 20px;">Select specific tasks delegated to Artificial Intelligence.</p>
        
        <div class="masonry-grid">
            
            <div class="taxonomy-card">
                <h3>Conceptualization</h3>
                <label class="tax-item"><input type="checkbox" value="c:idea" class="tax-check"> Idea generation</label>
                <label class="tax-item"><input type="checkbox" value="c:obj" class="tax-check"> Defining objectives</label>
                <label class="tax-item"><input type="checkbox" value="c:rq" class="tax-check"> Research questions</label>
                <label class="tax-item"><input type="checkbox" value="c:feas" class="tax-check"> Feasibility assessment</label>
                <label class="tax-item"><input type="checkbox" value="c:pre" class="tax-check"> Hypothesis viability</label>
                <label class="tax-item"><input type="checkbox" value="c:sim" class="tax-check"> Simulated debate</label>
            </div>

            <div class="taxonomy-card">
                <h3>Literature Review</h3>
                <label class="tax-item"><input type="checkbox" value="l:srch" class="tax-check"> Search & Discovery</label>
                <label class="tax-item"><input type="checkbox" value="l:sum" class="tax-check"> Summarization</label>
                <label class="tax-item"><input type="checkbox" value="l:map" class="tax-check"> Concept Mapping</label>
                <label class="tax-item"><input type="checkbox" value="l:pat" class="tax-check"> Patterns & Themes</label>
                <label class="tax-item"><input type="checkbox" value="l:gaps" class="tax-check"> Identifying Gaps</label>
                <label class="tax-item"><input type="checkbox" value="l:trans" class="tax-check"> Translation</label>
            </div>

            <div class="taxonomy-card">
                <h3>Methodology</h3>
                <label class="tax-item"><input type="checkbox" value="m:des" class="tax-check"> Research Design</label>
                <label class="tax-item"><input type="checkbox" value="m:proto" class="tax-check"> Prototyping</label>
                <label class="tax-item"><input type="checkbox" value="m:meth" class="tax-check"> Validation</label>
            </div>

            <div class="taxonomy-card">
                <h3>Software & Automation</h3>
                <label class="tax-item"><input type="checkbox" value="s:gen" class="tax-check"> Code Generation</label>
                <label class="tax-item"><input type="checkbox" value="s:opt" class="tax-check"> Optimization</label>
                <label class="tax-item"><input type="checkbox" value="s:debug" class="tax-check"> Debugging</label>
                <label class="tax-item"><input type="checkbox" value="s:auto" class="tax-check"> Scripts</label>
                <label class="tax-item"><input type="checkbox" value="s:algs" class="tax-check"> Algorithms</label>
                <label class="tax-item"><input type="checkbox" value="s:doc" class="tax-check"> Documentation</label>
            </div>

            <div class="taxonomy-card">
                <h3>Data Management</h3>
                <label class="tax-item"><input type="checkbox" value="d:coll" class="tax-check"> Collection/Scraping</label>
                <label class="tax-item"><input type="checkbox" value="d:val" class="tax-check"> Validation/Quality</label>
                <label class="tax-item"><input type="checkbox" value="d:cln" class="tax-check"> Cleaning</label>
                <label class="tax-item"><input type="checkbox" value="d:cur" class="tax-check"> Curation</label>
                <label class="tax-item"><input type="checkbox" value="d:anl" class="tax-check"> Analysis</label>
                <label class="tax-item"><input type="checkbox" value="d:viz" class="tax-check"> Visualization</label>
                <label class="tax-item"><input type="checkbox" value="d:rep" class="tax-check"> Reporting Results</label>
                <label class="tax-item"><input type="checkbox" value="d:lbl" class="tax-check"> Labeling</label>
                <label class="tax-item"><input type="checkbox" value="d:syn" class="tax-check"> Synthetic Data</label>
                <label class="tax-item"><input type="checkbox" value="d:anon" class="tax-check"> Anonymization</label>
                <label class="tax-item"><input type="checkbox" value="d:trans" class="tax-check"> Translation</label>
            </div>

            <div class="taxonomy-card">
                <h3>Visuals</h3>
                <label class="tax-item"><input type="checkbox" value="v:gen" class="tax-check"> Image Generation</label>
                <label class="tax-item"><input type="checkbox" value="v:edit" class="tax-check"> Editing</label>
                <label class="tax-item"><input type="checkbox" value="v:chart" class="tax-check"> Charts/Diagrams</label>
            </div>

            <div class="taxonomy-card">
                <h3>Writing & Editing</h3>
                <label class="tax-item"><input type="checkbox" value="w:draft" class="tax-check"> Drafting</label>
                <label class="tax-item"><input type="checkbox" value="w:poly" class="tax-check"> Polishing</label>
                <label class="tax-item"><input type="checkbox" value="w:sum" class="tax-check"> Summarizing</label>
                <label class="tax-item"><input type="checkbox" value="w:con" class="tax-check"> Connecting Ideas</label>
                <label class="tax-item"><input type="checkbox" value="w:tone" class="tax-check"> Tone Adjustment</label>
                <label class="tax-item"><input type="checkbox" value="w:tra" class="tax-check"> Translation</label>
                <label class="tax-item"><input type="checkbox" value="w:ref" class="tax-check"> References</label>
                <label class="tax-item"><input type="checkbox" value="w:prs" class="tax-check"> Proofreading</label>
                <label class="tax-item"><input type="checkbox" value="w:title" class="tax-check"> Title Suggestions</label>
            </div>

            <div class="taxonomy-card">
                <h3>Ethics</h3>
                <label class="tax-item"><input type="checkbox" value="e:bias" class="tax-check"> Bias Mitigation</label>
                <label class="tax-item"><input type="checkbox" value="e:risk" class="tax-check"> Risk Assessment</label>
                <label class="tax-item"><input type="checkbox" value="e:comp" class="tax-check"> Compliance</label>
                <label class="tax-item"><input type="checkbox" value="e:conf" class="tax-check"> Conflict of Interest</label>
            </div>

            <div class="taxonomy-card">
                <h3>Critique & Feedback</h3>
                <label class="tax-item"><input type="checkbox" value="sup:qa" class="tax-check"> Q&A / Querying</label>
                <label class="tax-item"><input type="checkbox" value="sup:trd" class="tax-check"> Troubleshooting</label>
                <label class="tax-item"><input type="checkbox" value="sup:lim" class="tax-check"> Identifying Limits</label>
                <label class="tax-item"><input type="checkbox" value="sup:rec" class="tax-check"> Future Work Recs</label>
                <label class="tax-item"><input type="checkbox" value="sup:pub" class="tax-check"> Response to Reviewers</label>
            </div>
        </div>
    </div>

    <div class="button-group">
        <button type="button" class="btn-primary" onclick="generateLaTeX()">Generate Full Document</button>
        <button type="button" class="btn-secondary" onclick="generateSnippet()">Generate Snippet Only</button>
    </div>

    <div id="output-area">
        <div class="code-container">
            <div class="code-header">
                <span>LaTeX Source</span>
                <button type="button" class="btn-secondary" style="padding: 4px 10px; font-size: 0.8em;" onclick="copyToClipboard()">Copy Code</button>
            </div>
            <pre id="latex-code"></pre>
        </div>
    </div>
    
    <div class="footer-sponsor">
        <div class="counter-badge" title="Statements generated">
            <span id="counter-value">...</span> statements generated
        </div>
        <p>
            Help keep this tool alive <br/>
            <a href="https://www.paypal.com/donate/?hosted_button_id=8WA8FRVMB78W8" target="_blank" rel="noopener">
              <img src="https://img.shields.io/badge/Donate-PayPal-blue.svg" alt="Donate" style="margin-top:10px;">
            </a>
        </p>
    </div>

</div>

<script>
    // --- Utils ---
    function escapeLatex(str) {
        if (!str) return "";
        return str.replace(/([&%$#_{}])/g, "\\$1")
                  .replace(/~/g, "\\textasciitilde{}")
                  .replace(/\^/g, "\\textasciicircum{}");
    }

    // --- Comment Box Logic ---
    let commentCount = 0;
    function addCommentBox() {
        commentCount++;
        const container = document.getElementById('comments-container');
        const div = document.createElement('div');
        div.className = 'comment-box';
        div.id = `comment-box-${commentCount}`;
        div.innerHTML = `
            <div class="comment-header">
                <span class="comment-title">Comment #${commentCount}</span>
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="comment-star-${commentCount}">
                    <span style="font-size:0.85rem">Unnumbered</span>
                </div>
            </div>
            <textarea id="comment-text-${commentCount}" placeholder="Describe how AI was used..." rows="2"></textarea>
            <div style="text-align:right; margin-top:10px;">
                <button type="button" class="btn-danger" onclick="removeCommentBox(${commentCount})">Remove</button>
            </div>
        `;
        container.appendChild(div);
    }
    function removeCommentBox(id) {
        const box = document.getElementById(`comment-box-${id}`);
        if(box) box.remove();
    }

    // --- LaTeX Generation Logic ---
    function getFormData() {
        const authors = escapeLatex(document.getElementById('authors').value.trim());
        const tools = escapeLatex(document.getElementById('tools').value.trim());
        
        // Options
        const autobib = document.getElementById('opt-autobib').checked;
        const nocite = document.getElementById('opt-nocite').checked;
        
        // Title Config
        const titleFull = escapeLatex(document.getElementById('title-full').value.trim());
        const titleShort = escapeLatex(document.getElementById('title-short').value.trim());
        const titleLevel = document.getElementById('title-level').value.trim();
        
        // Rendering
        const columns = document.getElementById('render-cols').value || 3;
        const renderStar = document.getElementById('render-star').checked;
        const renderLang = document.getElementById('render-lang').value;
        const renderLabel = escapeLatex(document.getElementById('render-label').value.trim());

        // Comments
        const comments = [];
        const commentBoxes = document.querySelectorAll('.comment-box');
        commentBoxes.forEach(box => {
            const textarea = box.querySelector('textarea');
            const checkbox = box.querySelector('input[type="checkbox"]');
            if (textarea.value.trim()) {
                comments.push({
                    text: escapeLatex(textarea.value.trim()),
                    starred: checkbox.checked
                });
            }
        });

        // Taxonomy
        const taxonomy = [];
        document.querySelectorAll('.tax-check:checked').forEach(cb => taxonomy.push(cb.value));

        return { authors, tools, comments, autobib, nocite, titleFull, titleShort, titleLevel, columns, renderStar, taxonomy, renderLang, renderLabel };
    }

    function validate(data) {
        if (!data.authors) {
            alert("Please enter the Author names.");
            document.getElementById('authors').focus();
            return false;
        }
        return true;
    }

    function buildPreamble(data) {
        let opts = [];
        if(!data.autobib) opts.push("autobib=false");
        if(!data.nocite) opts.push("nocite=false");
        let optStr = opts.length ? `[${opts.join(',')}]` : '';
        return `\\usepackage${optStr}{aidisclose}`;
    }

    function buildConfiguration(data) {
        let code = "";
        
        // Title
        if(data.titleFull || data.titleLevel) {
            let cmd = "\\AIDdiscloseTitle";
            if(data.titleShort) cmd += `[${data.titleShort}]`;
            cmd += `{${data.titleFull || "Generative AI Disclosure"}}`;
            if(data.titleLevel) cmd += `[${data.titleLevel}]`;
            code += `${cmd}\n\n`;
        }

        // Taxonomy
        if(data.taxonomy.length > 0) {
            code += `% Taxonomy Activation\n`;
            data.taxonomy.forEach(key => {
                code += `\\AIDactivate{${key}}\n`;
            });
            code += `\n`;
        }
        
        // Tools
        if(data.tools) {
            code += `\\AIDtoolsUsed{${data.tools}}\n\n`;
        } else {
            code += `\\AIDtoolsUsed{}\n\n`;
        }
        
        // Comments
        data.comments.forEach(c => {
            const env = c.starred ? "AIDcomment*" : "AIDcomment";
            code += `\\begin{${env}}\n${c.text}\n\\end{${env}}\n\n`;
        });

        return code;
    }

    function buildRender(data) {
        const cmd = data.renderStar ? "\\AIDrenderDeclaration*" : "\\AIDrenderDeclaration";
        
        // Build options list for new key-value syntax
        let opts = [];
        if (data.columns && data.columns != 3) opts.push(`ncols=${data.columns}`);
        
        // Only add lang if it is NOT default
        if (data.renderLang && data.renderLang !== 'default') {
            opts.push(`lang=${data.renderLang}`);
        }
        
        if (data.renderLabel) opts.push(`label=${data.renderLabel}`);

        const optStr = opts.length > 0 ? `[${opts.join(',')}]` : ""; 
        return `${cmd}${optStr}{${data.authors}}`;
    }

    function generateLaTeX() {
        const data = getFormData();
        if (!validate(data)) return;
        incrementGlobalCounter();

        let code = `\\documentclass{article}\n`;
        code += buildPreamble(data) + `\n\n`;
        code += `\\title{Generative AI Disclosure}\n`;
        code += `\\author{${data.authors}}\n`;
        code += `\\date{\\today}\n\n`;
        code += `\\begin{document}\n\n`;
        code += `\\maketitle\n\n`;
        code += `% --- aidisclose configuration ---\n`;
        code += buildConfiguration(data);
        code += `% --- aidisclose rendering ---\n`;
        code += buildRender(data);
        code += `\n\n\\end{document}`;

        displayOutput(code);
    }

    function generateSnippet() {
        const data = getFormData();
        if (!validate(data)) return;
        incrementGlobalCounter();

        let code = `% Add to Preamble:\n`;
        code += buildPreamble(data) + `\n\n`;
        code += `% Configuration:\n`;
        code += buildConfiguration(data);
        code += `% Rendering:\n`;
        code += buildRender(data);

        displayOutput(code);
    }

    function displayOutput(code) {
        document.getElementById('latex-code').textContent = code;
        const area = document.getElementById('output-area');
        area.style.display = 'block';
        area.scrollIntoView({behavior: "smooth"});
    }

    function copyToClipboard() {
        const code = document.getElementById('latex-code').textContent;
        navigator.clipboard.writeText(code).then(() => {
            const btn = document.querySelector('#output-area button');
            const originalText = btn.innerText;
            btn.innerText = "Copied!";
            setTimeout(() => btn.innerText = originalText, 2000);
        });
    }

    // --- Counter API ---
    const namespace = 'aidisclose_v1';
    const key = 'gaidet_button_clicks';
    
    function updateCounterUI(value) {
        const el = document.getElementById('counter-value');
        const badge = document.querySelector('.counter-badge');
        
        if(el) {
            el.innerText = value;
            // Add a helpful tooltip
            badge.title = `${value} statements generated`;

            // Logic to hide (match background) or show
            if (value == 0 || value === '...') {
                // Invisible to the eye, but selectable
                badge.style.backgroundColor = 'var(--background)'; 
                badge.style.color = 'var(--background)';
            } else {
                // Visible
                badge.style.backgroundColor = '#e2e8f0';
                badge.style.color = 'var(--text-secondary)';
            }
        }
    }
    
    fetch(`https://api.counterapi.dev/v1/${namespace}/${key}/`)
        .then(r => r.ok ? r.json() : {count:0})
        .then(d => updateCounterUI(d.count))
        .catch(e => updateCounterUI(0));

    function incrementGlobalCounter() {
        fetch(`https://api.counterapi.dev/v1/${namespace}/${key}/up`)
            .then(r => r.ok ? r.json() : {})
            .then(d => updateCounterUI(d.count))
            .catch(e => console.error(e));
    }
</script>

</body>
</html>